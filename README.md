# Yusi Backend (Go-Zero ç‰ˆæœ¬)

è¿™æ˜¯ Yusi åç«¯æœåŠ¡çš„ Go è¯­è¨€é‡æ„ç‰ˆæœ¬ï¼Œä½¿ç”¨ go-zero å¾®æœåŠ¡æ¡†æ¶å®ç°ã€‚

## ğŸ¯ ä»»åŠ¡ç›®æ ‡

### åŸºç¡€ç¯å¢ƒæ­å»º
- [x] é¡¹ç›®ç»“æ„åˆå§‹åŒ–
- [x] go-zero æ¡†æ¶é›†æˆ
- [x] æ•°æ®åº“é…ç½®ï¼ˆMySQL + GORMï¼‰
- [x] æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆUser, Diaryï¼‰
- [x] è‡ªåŠ¨å»ºè¡¨å’Œè¿ç§»
- [x] Redis é›†æˆ
- [ ] æ—¥å¿—é…ç½®ä¼˜åŒ–
- [ ] Docker å®¹å™¨åŒ–

### ç”¨æˆ·è®¤è¯æ¨¡å—
- [x] JWT å·¥å…·ç±»å®ç°
- [x] å¯†ç åŠ å¯†å·¥å…·ï¼ˆbcryptï¼‰
- [x] ç”¨æˆ·æ³¨å†Œæ¥å£
- [x] ç”¨æˆ·ç™»å½•æ¥å£
- [x] ç”¨æˆ·ç™»å‡ºæ¥å£
- [x] JWT è®¤è¯ä¸­é—´ä»¶
- [] Token é»‘åå•ï¼ˆRedisï¼‰
- [ ] åˆ·æ–° Token æœºåˆ¶
- [ ] å¯†ç é‡ç½®åŠŸèƒ½
- [ ] é‚®ç®±éªŒè¯

### æ—¥è®°ç®¡ç†æ¨¡å—
- [x] å†™æ—¥è®°æ¥å£
- [x] ç¼–è¾‘æ—¥è®°æ¥å£
- [x] è·å–æ—¥è®°è¯¦æƒ…æ¥å£
- [x] è·å–æ—¥è®°åˆ—è¡¨æ¥å£ï¼ˆåˆ†é¡µï¼‰
- [ ] åˆ é™¤æ—¥è®°æ¥å£
- [ ] æ—¥è®°æƒé™æ§åˆ¶ï¼ˆåªèƒ½ç¼–è¾‘è‡ªå·±çš„ï¼‰
- [ ] æ—¥è®°æœç´¢åŠŸèƒ½
- [ ] æ—¥è®°æ ‡ç­¾ç³»ç»Ÿ
- [ ] æ—¥è®°å¯¼å‡ºåŠŸèƒ½

### AI åŠŸèƒ½æ¨¡å—
- [ ] Qwen API é›†æˆ
- [ ] æµå¼å“åº”å®ç°
- [ ] Milvus å‘é‡æ•°æ®åº“é›†æˆ
- [ ] æ—¥è®°å†…å®¹å‘é‡åŒ–
- [ ] åŸºäº RAG çš„å¯¹è¯ç³»ç»Ÿ
- [ ] å‘é‡æ£€ç´¢ä¼˜åŒ–
- [ ] AI èŠå¤©å†å²è®°å½•

### æƒ…æ™¯æˆ¿é—´æ¨¡å—
- [ ] æˆ¿é—´æ•°æ®æ¨¡å‹è®¾è®¡
- [ ] åˆ›å»ºæˆ¿é—´æ¥å£
- [ ] åŠ å…¥æˆ¿é—´æ¥å£
- [ ] å¼€å§‹æˆ¿é—´æ¥å£
- [ ] æäº¤å™è¿°æ¥å£
- [ ] ç”ŸæˆæŠ¥å‘Šæ¥å£
- [ ] æˆ¿é—´çŠ¶æ€ç®¡ç†
- [ ] WebSocket å®æ—¶é€šä¿¡
- [ ] æˆ¿é—´æƒé™æ§åˆ¶

### ä»£ç è´¨é‡ä¸æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] é›†æˆæµ‹è¯•
- [ ] API æ–‡æ¡£ç”Ÿæˆï¼ˆSwaggerï¼‰
- [ ] å‚æ•°éªŒè¯å¢å¼º
- [ ] é”™è¯¯å¤„ç†ç»Ÿä¸€åŒ–
- [ ] ä»£ç æ³¨é‡Šå®Œå–„
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å®‰å…¨å®¡è®¡

### è¿ç»´ä¸éƒ¨ç½²
- [ ] Docker é•œåƒæ„å»º
- [ ] docker-compose é…ç½®
- [ ] CI/CD æµç¨‹
- [ ] ç›‘æ§å‘Šè­¦
- [ ] æ—¥å¿—æ”¶é›†
- [ ] æ€§èƒ½ç›‘æ§
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

Yusi Backend æ˜¯åŸºäº go-zero æ¡†æ¶çš„åç«¯æœåŠ¡ï¼Œæä¾›æ—¥è®°ç®¡ç†ã€æƒ…æ™¯æˆ¿é—´åä½œä¸åŸºäºå‘é‡æ£€ç´¢çš„å¯¹è¯èƒ½åŠ›ã€‚æœ¬é¡¹ç›®æ˜¯ä» Spring Boot + Java ç‰ˆæœ¬é‡æ„è€Œæ¥ã€‚

## ğŸ›  æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: go-zero v1.6.0
- **è¯­è¨€**: Go 1.21+
- **æ•°æ®åº“**: MySQL 8.x
- **ç¼“å­˜**: Redis
- **ORM**: GORM (æ¨è)
- **å‘é‡æ•°æ®åº“**: Milvus/Zilliz Cloud (å¯é€‰)

## ğŸ“ é¡¹ç›®ç»“æ„

```
yusi-backend/
â”œâ”€â”€ api/                    # API å®šä¹‰æ–‡ä»¶
â”‚   â””â”€â”€ yusi.api           # go-zero API å®šä¹‰
â”œâ”€â”€ internal/              # å†…éƒ¨ä»£ç 
â”‚   â”œâ”€â”€ config/           # é…ç½®ç»“æ„
â”‚   â”œâ”€â”€ handler/          # HTTP å¤„ç†å™¨
â”‚   â”œâ”€â”€ logic/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ svc/              # æœåŠ¡ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ types/            # ç±»å‹å®šä¹‰
â”œâ”€â”€ model/                 # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ models.go         # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ etc/                   # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ yusi.yaml         # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ go.mod                 # Go æ¨¡å—å®šä¹‰
â””â”€â”€ yusi.go               # ç¨‹åºå…¥å£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Go 1.21 æˆ–æ›´é«˜ç‰ˆæœ¬
- MySQL 8.x
- Redis
- goctl å·¥å…· (å¯é€‰ï¼Œç”¨äºä»£ç ç”Ÿæˆ)

### å®‰è£… goctl (æ¨è)

```bash
# macOS/Linux
go install github.com/zeromicro/go-zero/tools/goctl@latest

# éªŒè¯å®‰è£…
goctl --version
```

### åˆå§‹åŒ–é¡¹ç›®

1. **å®‰è£…ä¾èµ–**

```bash
cd yusi-backend
go mod tidy
```

2. **é…ç½®æ•°æ®åº“**

ä¿®æ”¹ `config.yaml` ä¸­çš„æ•°æ®åº“é…ç½®ï¼š

```yaml
Mysql:
  DataSource: root:your_password@tcp(127.0.0.1:3306)/yusi?charset=utf8mb4&parseTime=true&loc=Local
```

3. **è®¾ç½®ç¯å¢ƒå˜é‡**

```bash
# Linux/macOS
export QWEN_API_KEY="your-qwen-api-key"
export YUSI_ENCRYPTION_KEY="your-encryption-key-min-16-chars"

# Windows PowerShell
$env:QWEN_API_KEY = "your-qwen-api-key"
$env:YUSI_ENCRYPTION_KEY = "your-encryption-key-min-16-chars"
```

4. **ç”Ÿæˆä»£ç ** (å¦‚æœå·²å®‰è£… goctl)

```bash
# ä» API å®šä¹‰ç”Ÿæˆä»£ç 
goctl api go -api api/yusi.api -dir .
```

5. **è¿è¡ŒæœåŠ¡**

```bash
go run yusi.go -f yusi.yaml
```

æœåŠ¡å°†åœ¨ `http://localhost:8088` å¯åŠ¨ã€‚

### å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8088/health
```

## ğŸ“ API æ¥å£

### ç”¨æˆ·æ¨¡å— (`/api/user`)

- `POST /api/user/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/user/login` - ç”¨æˆ·ç™»å½•
- `POST /api/user/logout` - ç”¨æˆ·ç™»å‡º (éœ€è¦è®¤è¯)

### æ—¥è®°æ¨¡å— (`/api/diary`)

- `GET /api/diary/list` - è·å–æ—¥è®°åˆ—è¡¨ (éœ€è¦è®¤è¯)
- `POST /api/diary` - å†™æ—¥è®° (éœ€è¦è®¤è¯)
- `PUT /api/diary` - ç¼–è¾‘æ—¥è®° (éœ€è¦è®¤è¯)
- `GET /api/diary/:diaryId` - è·å–æ—¥è®°è¯¦æƒ… (éœ€è¦è®¤è¯)

### æƒ…æ™¯æˆ¿é—´æ¨¡å— (`/api/room`)

- `POST /api/room/create` - åˆ›å»ºæˆ¿é—´ (éœ€è¦è®¤è¯)
- `POST /api/room/join` - åŠ å…¥æˆ¿é—´ (éœ€è¦è®¤è¯)
- `POST /api/room/start` - å¼€å§‹æˆ¿é—´ (éœ€è¦è®¤è¯)
- `POST /api/room/submit` - æäº¤å™è¿° (éœ€è¦è®¤è¯)
- `GET /api/room/report/:code` - è·å–æŠ¥å‘Š (éœ€è¦è®¤è¯)

### AI æ¨¡å— (`/api/ai`)

- `POST /api/ai/chat/stream` - AI æµå¼èŠå¤© (éœ€è¦è®¤è¯)

## ğŸ”§ å¼€å‘æŒ‡å—

### ä½¿ç”¨ goctl ç”Ÿæˆä»£ç 

```bash
# ç”Ÿæˆ API ä»£ç 
goctl api go -api api/yusi.api -dir .

# ç”Ÿæˆ Model ä»£ç 
goctl model mysql datasource -url "root:password@tcp(127.0.0.1:3306)/yusi" -table "user,diary" -dir ./model
```

### æ·»åŠ æ–°æ¥å£

1. åœ¨ `api/yusi.api` ä¸­å®šä¹‰æ–°çš„æ¥å£
2. è¿è¡Œ `goctl api go -api api/yusi.api -dir .` ç”Ÿæˆä»£ç 
3. åœ¨ç”Ÿæˆçš„ `logic` æ–‡ä»¶ä¸­å®ç°ä¸šåŠ¡é€»è¾‘

### æ•°æ®åº“è¿ç§»

ä½¿ç”¨ GORM çš„ AutoMigrate æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œ SQL è„šæœ¬ï¼š

```go
// åœ¨åˆå§‹åŒ–æ—¶è‡ªåŠ¨è¿ç§»
db.AutoMigrate(&model.User{}, &model.Diary{})
```

## ğŸ” è®¤è¯ä¸æˆæƒ

é¡¹ç›®ä½¿ç”¨ JWT è¿›è¡Œè®¤è¯ï¼Œéœ€è¦åœ¨ `config.yaml` ä¸­é…ç½®å¯†é’¥ï¼š

```yaml
Auth:
  AccessSecret: your-secret-key-here
  AccessExpire: 86400  # 24å°æ—¶
```

## ğŸŒŸ ç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | Java ç‰ˆæœ¬ | Go ç‰ˆæœ¬ |
|------|----------|---------|
| å¯åŠ¨é€Ÿåº¦ | ~10s | ~1s |
| å†…å­˜å ç”¨ | ~300MB | ~50MB |
| å¹¶å‘æ€§èƒ½ | ä¸­ | é«˜ |
| éƒ¨ç½²å¤§å° | ~50MB JAR | ~15MB äºŒè¿›åˆ¶ |

## ğŸ“¦ æ„å»ºä¸éƒ¨ç½²

### ç¼–è¯‘

```bash
# ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶
go build -o yusi-server yusi.go

# äº¤å‰ç¼–è¯‘ (Linux)
GOOS=linux GOARCH=amd64 go build -o yusi-server-linux yusi.go
```

### è¿è¡Œ

```bash
./yusi-server -f config.yaml
```

### Docker éƒ¨ç½² (TODO)

```bash
# æ„å»ºé•œåƒ
docker build -t yusi-backend:latest .

# è¿è¡Œå®¹å™¨
docker run -p 20611:20611 yusi-backend:latest
```

## ğŸ”„ ä» Java ç‰ˆæœ¬è¿ç§»

è¯¦è§ [MIGRATION.md](./MIGRATION.md)

## ğŸ“š ç›¸å…³èµ„æº

- [go-zero å®˜æ–¹æ–‡æ¡£](https://go-zero.dev/)
- [go-zero GitHub](https://github.com/zeromicro/go-zero)
- [goctl å·¥å…·ä½¿ç”¨](https://go-zero.dev/docs/tutorials/cli/overview)

## âš ï¸ æ³¨æ„äº‹é¡¹

1. ç¡®ä¿è®¾ç½® `YUSI_ENCRYPTION_KEY` ç¯å¢ƒå˜é‡ä»¥å¯ç”¨å­—æ®µåŠ å¯†
2. ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹ `Auth.AccessSecret` ä¸ºå¼ºå¯†é’¥
3. ä¸è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æäº¤çœŸå®çš„ API Key å’Œå¯†ç 
4. Redis é…ç½®æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´

## ğŸ“„ è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ä¿æŒä¸€è‡´

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
