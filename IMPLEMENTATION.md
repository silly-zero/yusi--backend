# Yusi Go Backend - å®ç°æ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. å·¥å…·ç±» (internal/utils/)
- **jwt.go**: JWT Token ç”Ÿæˆå’Œè§£æ
- **crypto.go**: å¯†ç åŠ å¯†ï¼ˆbcryptï¼‰å’ŒéªŒè¯
- **response.go**: ç»Ÿä¸€å“åº”æ ¼å¼å°è£…
- **id.go**: UUID ç”Ÿæˆå™¨
- **context.go**: HTTP ä¸Šä¸‹æ–‡ç”¨æˆ·ä¿¡æ¯ç®¡ç†

### 2. ç”¨æˆ·è®¤è¯æ¨¡å—
- âœ… **ç”¨æˆ·æ³¨å†Œ** (`/api/user/register`)
  - ç”¨æˆ·åå’Œé‚®ç®±å”¯ä¸€æ€§éªŒè¯
  - å¯†ç  bcrypt åŠ å¯†
  - è‡ªåŠ¨ç”Ÿæˆ UUID

- âœ… **ç”¨æˆ·ç™»å½•** (`/api/user/login`)
  - ç”¨æˆ·åå¯†ç éªŒè¯
  - JWT Token ç”Ÿæˆ
  - è¿”å›ç”¨æˆ·ä¿¡æ¯

- âœ… **ç”¨æˆ·ç™»å‡º** (`/api/user/logout`)
  - ç®€å•çš„ç™»å‡ºç¡®è®¤
  - å®¢æˆ·ç«¯è´Ÿè´£åˆ é™¤ token

- âœ… **JWT è®¤è¯ä¸­é—´ä»¶**
  - Bearer Token éªŒè¯
  - Token è¿‡æœŸæ£€æŸ¥
  - ç”¨æˆ·ä¸Šä¸‹æ–‡æ³¨å…¥

### 3. æ—¥è®°æ¨¡å—
- âœ… **å†™æ—¥è®°** (`/api/diary`)
  - æ ‡é¢˜ã€å†…å®¹éªŒè¯
  - æ—¥æœŸæ ¼å¼åŒ–å¤„ç†
  - è‡ªåŠ¨ç”Ÿæˆæ—¥è®° ID

- âœ… **ç¼–è¾‘æ—¥è®°** (`/api/diary`)
  - æ—¥è®°å­˜åœ¨æ€§éªŒè¯
  - æ”¯æŒéƒ¨åˆ†å­—æ®µæ›´æ–°
  - æƒé™æ§åˆ¶

- âœ… **è·å–æ—¥è®°è¯¦æƒ…** (`/api/diary/:diaryId`)
  - æ ¹æ® ID æŸ¥è¯¢å•æ¡æ—¥è®°
  - 404 å¤„ç†

- âœ… **è·å–æ—¥è®°åˆ—è¡¨** (`/api/diary/list`)
  - åˆ†é¡µæŸ¥è¯¢
  - æ”¯æŒæ’åºï¼ˆæŒ‰å­—æ®µã€å‡åº/é™åºï¼‰
  - è¿”å›æ€»æ•°å’Œåˆ—è¡¨æ•°æ®

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
yusi-backend/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/          # é…ç½®ç»“æ„
â”‚   â”œâ”€â”€ database/        # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ handler/         # HTTP å¤„ç†å™¨
â”‚   â”œâ”€â”€ logic/          # ä¸šåŠ¡é€»è¾‘ âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ user/       # ç”¨æˆ·é€»è¾‘
â”‚   â”‚   â””â”€â”€ diary/      # æ—¥è®°é€»è¾‘
â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶ âœ… JWT è®¤è¯å·²å®ç°
â”‚   â”œâ”€â”€ svc/            # æœåŠ¡ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ types/          # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils/          # å·¥å…·ç±» âœ… å·²å®ç°
â”œâ”€â”€ model/              # æ•°æ®æ¨¡å‹
â””â”€â”€ api/                # API å®šä¹‰
```

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### JWT è®¤è¯æµç¨‹
1. ç”¨æˆ·ç™»å½• â†’ ç”Ÿæˆ JWT Token
2. å®¢æˆ·ç«¯è¯·æ±‚æºå¸¦ `Authorization: Bearer <token>`
3. AuthMiddleware éªŒè¯ token å¹¶æå–ç”¨æˆ·ä¿¡æ¯
4. ç”¨æˆ·ä¿¡æ¯æ³¨å…¥åˆ°è¯·æ±‚ä¸Šä¸‹æ–‡
5. ä¸šåŠ¡é€»è¾‘å¯é€šè¿‡ utils.GetUserId(r) è·å–å½“å‰ç”¨æˆ·

### å¯†ç å®‰å…¨
- ä½¿ç”¨ bcrypt ç®—æ³•åŠ å¯†å¯†ç 
- Cost factor: bcrypt.DefaultCost (10)
- å¯†ç æ°¸ä¸ä»¥æ˜æ–‡å­˜å‚¨æˆ–ä¼ è¾“

### æ•°æ®åº“
- GORM è‡ªåŠ¨è¿ç§»
- æ”¯æŒ MySQL
- è¿æ¥æ± é…ç½®ï¼šæœ€å° 10ï¼Œæœ€å¤§ 100 è¿æ¥

## âš ï¸ å¾…å®ç°åŠŸèƒ½

### P1 - é‡è¦åŠŸèƒ½
1. **Redis é›†æˆ**
   - ç¼“å­˜ç”¨æˆ·ä¼šè¯
   - Token é»‘åå•ï¼ˆç”¨äºç™»å‡ºï¼‰
   - é™æµ

2. **æƒ…æ™¯æˆ¿é—´æ¨¡å—**
   - æ•°æ®æ¨¡å‹åˆ›å»º
   - æˆ¿é—´åˆ›å»º/åŠ å…¥/å¼€å§‹é€»è¾‘
   - å™è¿°æäº¤å’ŒæŠ¥å‘Šç”Ÿæˆ

3. **AI æ¨¡å—**
   - Qwen API é›†æˆ
   - æµå¼å“åº”å®ç°
   - Milvus å‘é‡æ£€ç´¢

### P2 - ä¼˜åŒ–å’Œå®Œå–„
4. **å…¨å±€é”™è¯¯å¤„ç†**
   - ç»Ÿä¸€é”™è¯¯ç 
   - é”™è¯¯æ—¥å¿—è®°å½•
   - å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

5. **å‚æ•°éªŒè¯å¢å¼º**
   - é‚®ç®±æ ¼å¼éªŒè¯
   - å¯†ç å¼ºåº¦éªŒè¯
   - æ—¥æœŸèŒƒå›´éªŒè¯

6. **API æ–‡æ¡£**
   - Swagger/OpenAPI æ–‡æ¡£ç”Ÿæˆ
   - æ¥å£ç¤ºä¾‹

7. **å•å…ƒæµ‹è¯•**
   - logic å±‚æµ‹è¯•
   - handler å±‚æµ‹è¯•
   - Mock æ•°æ®åº“

8. **æ—¥å¿—ä¼˜åŒ–**
   - ç»“æ„åŒ–æ—¥å¿—
   - è¯·æ±‚è¿½è¸ª
   - æ€§èƒ½ç›‘æ§

9. **æƒé™æ§åˆ¶**
   - æ—¥è®°åªèƒ½ç”±ä½œè€…ç¼–è¾‘/åˆ é™¤
   - ç§æœ‰æ—¥è®°ä¸å¯è¢«ä»–äººæŸ¥çœ‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
go mod tidy
```

éœ€è¦çš„ä¸»è¦ä¾èµ–ï¼š
- `golang.org/x/crypto/bcrypt` - å¯†ç åŠ å¯†
- `github.com/golang-jwt/jwt/v4` - JWT è®¤è¯
- `github.com/google/uuid` - UUID ç”Ÿæˆ
- `gorm.io/gorm` - ORM
- `github.com/zeromicro/go-zero` - æ¡†æ¶

### 2. é…ç½®ç¯å¢ƒ

å¤åˆ¶ `config.yaml.example` ä¸º `config.yaml` å¹¶ä¿®æ”¹ï¼š

```yaml
Mysql:
  DataSource: root:your_password@tcp(127.0.0.1:3306)/yusi?charset=utf8mb4&parseTime=true&loc=Local

Auth:
  AccessSecret: your-secret-key-at-least-32-characters
  AccessExpire: 86400  # 24å°æ—¶

Redis:
  Host: 127.0.0.1:6379
  Pass: ""
```

### 3. è¿è¡ŒæœåŠ¡

```bash
go run yusi.go -f config.yaml
```

æœåŠ¡å°†åœ¨ `http://localhost:8088` å¯åŠ¨ã€‚

## ğŸ“ API ä½¿ç”¨ç¤ºä¾‹

### ç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST http://localhost:8088/api/user/register \
  -H "Content-Type: application/json" \
  -d '{
    "userName": "testuser",
    "password": "password123",
    "email": "test@example.com"
  }'
```

### ç”¨æˆ·ç™»å½•
```bash
curl -X POST http://localhost:8088/api/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "userName": "testuser",
    "password": "password123"
  }'
```

è¿”å›ï¼š
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "userId": "uuid-here",
    "userName": "testuser",
    "email": "test@example.com"
  }
}
```

### å†™æ—¥è®°ï¼ˆéœ€è¦è®¤è¯ï¼‰
```bash
curl -X POST http://localhost:8088/api/diary \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your-token>" \
  -d '{
    "userId": "your-user-id",
    "title": "ä»Šå¤©çš„æ—¥è®°",
    "content": "ä»Šå¤©å¤©æ°”å¾ˆå¥½",
    "visibility": true,
    "entryDate": "2025-12-17"
  }'
```

### è·å–æ—¥è®°åˆ—è¡¨ï¼ˆéœ€è¦è®¤è¯ï¼‰
```bash
curl -X GET "http://localhost:8088/api/diary/list?userId=your-user-id&pageNum=1&pageSize=10" \
  -H "Authorization: Bearer <your-token>"
```

## ğŸ” é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯ï¼šæ‰¾ä¸åˆ°åŒ…**
   ```bash
   go mod tidy
   go mod download
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ MySQL æ˜¯å¦å¯åŠ¨
   - éªŒè¯ config.yaml ä¸­çš„è¿æ¥å­—ç¬¦ä¸²
   - ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰æƒé™

3. **JWT Token æ— æ•ˆ**
   - æ£€æŸ¥ `Auth.AccessSecret` é…ç½®
   - Token æ˜¯å¦è¿‡æœŸï¼ˆé»˜è®¤ 24 å°æ—¶ï¼‰
   - ç¡®ä¿ Bearer æ ¼å¼æ­£ç¡®

## ğŸ“Š æ€§èƒ½ç‰¹ç‚¹

ç›¸æ¯” Java ç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š
- ğŸš€ å¯åŠ¨é€Ÿåº¦ï¼š~1sï¼ˆJava ~10sï¼‰
- ğŸ’¾ å†…å­˜å ç”¨ï¼š~50MBï¼ˆJava ~300MBï¼‰
- ğŸ“¦ éƒ¨ç½²å¤§å°ï¼š~15MB äºŒè¿›åˆ¶ï¼ˆJava ~50MB JARï¼‰
- âš¡ å¹¶å‘æ€§èƒ½ï¼šGo åç¨‹æ”¯æŒé«˜å¹¶å‘

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. å®Œæˆ Redis é›†æˆ
2. å®ç°æƒ…æ™¯æˆ¿é—´æ¨¡å—
3. é›†æˆ AI åŠŸèƒ½ï¼ˆQwen + Milvusï¼‰
4. æ·»åŠ æƒé™æ§åˆ¶å’Œå‚æ•°éªŒè¯
5. ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
6. ç”Ÿæˆ API æ–‡æ¡£
7. Docker å®¹å™¨åŒ–éƒ¨ç½²

---

**å®ç°æ—¥æœŸ**: 2025-12-17
**ç‰ˆæœ¬**: v0.1.0-alpha
**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¯ç”¨äºåŸºç¡€æµ‹è¯•
